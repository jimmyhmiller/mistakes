<!DOCTYPE html>
<html>
  <head>
    <title>sweet code jam</title>
    <script src='js/codemirror.js' type='text/javascript'></script>
    <script src='js/javascript.js' type='text/javascript'></script>
    <link href='css/codemirror_custom.css' rel='stylesheet' type='text/css' />
    <link href='css/site.css' rel='stylesheet' type='text/css' />
  </head>
  <body>
    <div id='left'>
    <textarea id='code'></textarea>
    </div>
    <div id='right'>
      <pre id='results'></pre>
    </div>
    <script>
        function runCodes() {
            var v = editor.getValue().split('\n');
            var res = '';
            for (var i = 0; i < v.length; i++) {
                if (v[i]) {
                    try {
                        res += JSON.stringify(eval(v.slice(0,i+1).join(';'))) + '\n';
                        } catch(e) {
                        if (!(e instanceof SyntaxError)) {
                            res += e;
                            } else {
                            res += '\n';
                        }
                    }
                    } else {
                    res += '\n';
                }
            }
            result.setValue(res);
        }

        var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
            mode: 'javascript',
            matchBrackets: true,
            onChange: runCodes,
            smartIndent: false
        });

        var result = CodeMirror.fromTextArea(document.getElementById('results'), {
            mode: 'javascript',
            matchBrackets: true,
            smartIndent: false
        });

        function xhr(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
            xhr.onload = callback;
            xhr.send();
        }

        if (window.location.hash) {
            xhr("https://api.github.com/gists/" + window.location.hash.substring(1), function() {
                var r = JSON.parse(this.response);
                for (var k in r.files) {
                    return editor.setValue(r.files[k].content);
                }
            });
        }
    </script>
  </body>
</html>
